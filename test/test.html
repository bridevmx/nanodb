<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NanoDB - Performance Tester</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          animation: {
            'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        }
      }
    }
  </script>
  <style>
    .log-container { 
      font-family: 'Courier New', monospace;
      scroll-behavior: smooth;
    }
    @keyframes slideIn {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }
    .log-entry {
      animation: slideIn 0.2s ease-out;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 min-h-screen p-4">
  
  <!-- Header -->
  <div class="max-w-7xl mx-auto mb-6 text-center">
    <h1 class="text-5xl font-bold text-white mb-2 drop-shadow-lg">ğŸš€ NanoDB Tester</h1>
    <p class="text-white text-lg opacity-90">Performance Testing Dashboard</p>
  </div>

  <!-- Main Grid -->
  <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-4">
    
    <!-- Sidebar: Control Panel -->
    <div class="lg:col-span-3 space-y-4">
      
      <!-- Auth Card -->
      <div class="bg-white rounded-xl shadow-2xl p-5">
        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b-2 border-indigo-500 pb-2">ğŸ” Authentication</h2>
        <div class="space-y-3">
          <input type="email" id="email" value="admin@local.host" 
            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none text-sm">
          <input type="password" id="password" value="password123"
            class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:border-indigo-500 focus:outline-none text-sm">
          <button onclick="login()" 
            class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transition-all">
            <span id="connectionStatus" class="inline-block w-2 h-2 rounded-full mr-2 bg-red-500"></span>
            Login
          </button>
        </div>
      </div>


      <!-- Intensity Selector -->
      <div class="bg-white rounded-xl shadow-2xl p-5">
        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b-2 border-indigo-500 pb-2">ğŸ® Test Intensity</h2>
        <div class="grid grid-cols-2 gap-2">
          <button onclick="setIntensity('low')" 
            class="intensity-btn border-2 border-green-400 bg-green-50 hover:bg-green-100 text-green-700 px-3 py-3 rounded-lg font-bold text-sm transition-all active">
            ğŸŸ¢ Low<br><span class="text-xs">10 ops</span>
          </button>
          <button onclick="setIntensity('medium')" 
            class="intensity-btn border-2 border-yellow-400 bg-yellow-50 hover:bg-yellow-100 text-yellow-700 px-3 py-3 rounded-lg font-bold text-sm transition-all">
            ğŸŸ¡ Med<br><span class="text-xs">50 ops</span>
          </button>
          <button onclick="setIntensity('high')" 
            class="intensity-btn border-2 border-orange-400 bg-orange-50 hover:bg-orange-100 text-orange-700 px-3 py-3 rounded-lg font-bold text-sm transition-all">
            ğŸŸ  High<br><span class="text-xs">200 ops</span>
          </button>
          <button onclick="setIntensity('ultra')" 
            class="intensity-btn border-2 border-red-400 bg-red-50 hover:bg-red-100 text-red-700 px-3 py-3 rounded-lg font-bold text-sm transition-all">
            ğŸ”´ Ultra<br><span class="text-xs">1000 ops</span>
          </button>
        </div>
        <div id="intensityInfo" class="mt-3 bg-gray-50 p-3 rounded-lg text-xs text-gray-700 leading-relaxed">
          <strong class="text-indigo-600">LOW INTENSITY</strong><br>
          â€¢ 10 operations<br>
          â€¢ Sequential execution<br>
          â€¢ ~1-2 seconds
        </div>
      </div>

      <!-- Test Controls -->
      <div class="bg-white rounded-xl shadow-2xl p-5">
        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b-2 border-indigo-500 pb-2">ğŸ¯ Tests</h2>
        <div class="space-y-2">
          <button onclick="runFullTest()" id="testBtn"
            class="w-full bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-4 py-2 rounded-lg font-semibold hover:shadow-lg transition-all">
            â–¶ï¸ Full Test
          </button>
          <button onclick="runCRUDTest()"
            class="w-full bg-blue-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-blue-600 transition-all">
            ğŸ“ CRUD
          </button>
          <button onclick="runBatchTest()"
            class="w-full bg-green-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-green-600 transition-all">
            ğŸ“¦ Batch
          </button>
          <button onclick="runConcurrentTest()"
            class="w-full bg-purple-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-purple-600 transition-all">
            âš¡ Concurrent
          </button>
          <button onclick="clearLogs()"
            class="w-full bg-gray-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-gray-600 transition-all">
            ğŸ—‘ï¸ Clear Logs
          </button>
          <button onclick="deleteAllData()"
            class="w-full bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600 transition-all">
            ğŸ’£ Delete Data
          </button>
        </div>
      </div>

      <!-- DB Stats -->
      <div class="bg-white rounded-xl shadow-2xl p-5">
        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b-2 border-indigo-500 pb-2">ğŸ“Š Cache Stats</h2>
        <div class="grid grid-cols-2 gap-2">
          <div class="bg-gradient-to-br from-indigo-500 to-purple-600 text-white p-3 rounded-lg">
            <div class="text-xs opacity-80">Size</div>
            <div class="text-2xl font-bold" id="cacheSize">0</div>
          </div>
          <div class="bg-gradient-to-br from-indigo-500 to-purple-600 text-white p-3 rounded-lg">
            <div class="text-xs opacity-80">Hit Rate</div>
            <div class="text-2xl font-bold"><span id="hitRate">0</span>%</div>
          </div>
          <div class="bg-gradient-to-br from-indigo-500 to-purple-600 text-white p-3 rounded-lg">
            <div class="text-xs opacity-80">Hits</div>
            <div class="text-2xl font-bold" id="totalHits">0</div>
          </div>
          <div class="bg-gradient-to-br from-indigo-500 to-purple-600 text-white p-3 rounded-lg">
            <div class="text-xs opacity-80">Misses</div>
            <div class="text-2xl font-bold" id="totalMisses">0</div>
          </div>
        </div>
        <button onclick="fetchStats()" class="w-full mt-3 bg-indigo-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-indigo-600 transition-all">
          ğŸ”„ Refresh
        </button>
      </div>

    </div>

    <!-- Main Content -->
    <div class="lg:col-span-9 space-y-4">
      
      <!-- Metrics -->
      <div class="bg-white rounded-xl shadow-2xl p-5">
        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b-2 border-indigo-500 pb-2">âš¡ Performance Metrics</h2>
        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
          <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-indigo-500">
            <div class="text-xs text-gray-500 mb-1">Avg Latency</div>
            <div class="text-3xl font-bold text-gray-800"><span id="avgLatency">0</span> <span class="text-sm">ms</span></div>
            <div class="mt-2 bg-gray-200 rounded-full h-2">
              <div id="latencyProgress" class="bg-gradient-to-r from-indigo-500 to-purple-600 h-2 rounded-full transition-all" style="width: 0%"></div>
            </div>
          </div>
          <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-green-500">
            <div class="text-xs text-gray-500 mb-1">Throughput</div>
            <div class="text-3xl font-bold text-gray-800"><span id="throughput">0</span> <span class="text-sm">ops/s</span></div>
            <div class="mt-2 bg-gray-200 rounded-full h-2">
              <div id="throughputProgress" class="bg-gradient-to-r from-green-500 to-emerald-600 h-2 rounded-full transition-all" style="width: 0%"></div>
            </div>
          </div>
          <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-blue-500">
            <div class="text-xs text-gray-500 mb-1">Success Rate</div>
            <div class="text-3xl font-bold text-gray-800"><span id="successRate">0</span><span class="text-sm">%</span></div>
            <div class="mt-2 bg-gray-200 rounded-full h-2">
              <div id="successProgress" class="bg-gradient-to-r from-blue-500 to-cyan-600 h-2 rounded-full transition-all" style="width: 0%"></div>
            </div>
          </div>
          <div class="bg-gray-50 p-4 rounded-lg border-l-4 border-purple-500">
            <div class="text-xs text-gray-500 mb-1">Total Ops</div>
            <div class="text-3xl font-bold text-gray-800"><span id="totalOps">0</span></div>
            <div class="mt-2 bg-gray-200 rounded-full h-2">
              <div id="opsProgress" class="bg-gradient-to-r from-purple-500 to-pink-600 h-2 rounded-full transition-all" style="width: 0%"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div id="progressContainer" class="bg-white rounded-xl shadow-2xl p-5 hidden">
        <div class="flex justify-between items-center mb-2">
          <span class="text-sm font-semibold text-gray-700">Progress: <span id="progressText">0/0</span></span>
          <span class="text-sm font-semibold text-gray-700"><span id="progressPercent">0</span>%</span>
        </div>
        <div class="bg-gray-200 rounded-full h-4">
          <div id="progressBar" class="bg-gradient-to-r from-indigo-500 to-purple-600 h-4 rounded-full transition-all flex items-center justify-end pr-2" style="width: 0%">
            <span class="text-white text-xs font-bold"></span>
          </div>
        </div>
      </div>

      <!-- Logs -->
      <div class="bg-white rounded-xl shadow-2xl p-5">
        <h2 class="text-xl font-bold mb-4 text-gray-800 border-b-2 border-indigo-500 pb-2">ğŸ“‹ Activity Log</h2>
        <div id="logContainer" class="log-container bg-gray-900 text-gray-300 p-4 rounded-lg h-96 overflow-y-auto text-sm">
          <div class="log-entry text-blue-400">[Ready] Waiting for test execution...</div>
        </div>
      </div>

    </div>
  </div>

  <script>
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONFIGURATION
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    const API_URL = 'http://localhost:3000';
    let authToken = null;
    let currentIntensity = 'low';
    let isRunning = false;
    
    const intensityConfig = {
      low: { 
        operations: 10, 
        concurrent: 2, 
        description: 'LOW INTENSITY\nâ€¢ 10 operations\nâ€¢ 2 concurrent\nâ€¢ ~1-2 seconds' 
      },
      medium: { 
        operations: 50, 
        concurrent: 5, 
        description: 'MEDIUM INTENSITY\nâ€¢ 50 operations\nâ€¢ 5 concurrent\nâ€¢ ~5-10 seconds' 
      },
      high: { 
        operations: 200, 
        concurrent: 10, 
        description: 'HIGH INTENSITY\nâ€¢ 200 operations\nâ€¢ 10 concurrent\nâ€¢ ~20-30 seconds' 
      },
      ultra: { 
        operations: 1000, 
        concurrent: 20, 
        description: 'ULTRA INTENSITY\nâ€¢ 1000 operations\nâ€¢ 20 concurrent\nâ€¢ ~60-120 seconds' 
      }
    };

    const metrics = {
      totalOps: 0,
      successOps: 0,
      failedOps: 0,
      totalLatency: 0,
      startTime: null,
      endTime: null
    };

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // UTILITIES
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // CONCURRENCY POOL
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    class ConcurrencyPool {
      constructor(limit) {
        this.limit = limit;
        this.running = 0;
        this.queue = [];
      }

      async run(fn) {
        while (this.running >= this.limit) {
          await new Promise(resolve => this.queue.push(resolve));
        }
        
        this.running++;
        
        try {
          return await fn();
        } finally {
          this.running--;
          const resolve = this.queue.shift();
          if (resolve) resolve();
        }
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // AUTH
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function login() {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      try {
        const response = await fetch(`${API_URL}/api/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, collection: '_superusers' })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          authToken = data.token;
          log('success', `âœ… Logged in as ${email}`);
          document.getElementById('connectionStatus').className = 'inline-block w-2 h-2 rounded-full mr-2 bg-green-500 animate-pulse';
          fetchStats();
        } else {
          log('error', `âŒ Login failed: ${data.error}`);
          document.getElementById('connectionStatus').className = 'inline-block w-2 h-2 rounded-full mr-2 bg-red-500';
        }
      } catch (error) {
        log('error', `âŒ Connection error: ${error.message}`);
        document.getElementById('connectionStatus').className = 'inline-block w-2 h-2 rounded-full mr-2 bg-red-500';
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // LOGGING
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function log(type, message) {
      const container = document.getElementById('logContainer');
      const timestamp = new Date().toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      
      const colors = {
        success: 'text-green-400',
        error: 'text-red-400',
        info: 'text-blue-400',
        warning: 'text-yellow-400'
      };
      
      entry.innerHTML = `<span class="text-gray-500">[${timestamp}]</span> <span class="${colors[type] || 'text-gray-300'}">${message}</span>`;
      container.appendChild(entry);
      container.scrollTop = container.scrollHeight;
    }

    function clearLogs() {
      document.getElementById('logContainer').innerHTML = '';
      log('info', 'Logs cleared');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // METRICS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function updateMetrics() {
      const duration = (metrics.endTime - metrics.startTime) / 1000 || 0.1;
      const avgLatency = metrics.totalOps > 0 ? (metrics.totalLatency / metrics.totalOps).toFixed(2) : 0;
      const throughput = duration > 0 ? (metrics.totalOps / duration).toFixed(2) : 0;
      const successRate = metrics.totalOps > 0 ? ((metrics.successOps / metrics.totalOps) * 100).toFixed(1) : 0;
      
      document.getElementById('avgLatency').textContent = avgLatency;
      document.getElementById('throughput').textContent = throughput;
      document.getElementById('successRate').textContent = successRate;
      document.getElementById('totalOps').textContent = metrics.totalOps;
      
      document.getElementById('latencyProgress').style.width = Math.min((avgLatency / 100) * 100, 100) + '%';
      document.getElementById('throughputProgress').style.width = Math.min((throughput / 200) * 100, 100) + '%';
      document.getElementById('successProgress').style.width = successRate + '%';
      document.getElementById('opsProgress').style.width = Math.min((metrics.totalOps / 1000) * 100, 100) + '%';
    }

    function resetMetrics() {
      metrics.totalOps = 0;
      metrics.successOps = 0;
      metrics.failedOps = 0;
      metrics.totalLatency = 0;
      metrics.startTime = Date.now();
      metrics.endTime = null;
    }

    function updateProgress(current, total) {
      const percent = ((current / total) * 100).toFixed(1);
      document.getElementById('progressText').textContent = `${current}/${total}`;
      document.getElementById('progressPercent').textContent = percent;
      document.getElementById('progressBar').style.width = percent + '%';
      document.getElementById('progressContainer').classList.remove('hidden');
    }

    function hideProgress() {
      document.getElementById('progressContainer').classList.add('hidden');
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // API REQUESTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    async function makeRequest(method, url, data = null) {
      const start = Date.now();
      
      try {
        const options = {
          method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': authToken ? `Bearer ${authToken}` : ''
          },
          signal: AbortSignal.timeout(30000) // 30s timeout
        };
        
        if (data) options.body = JSON.stringify(data);
        
        const response = await fetch(`${API_URL}${url}`, options);
        const result = await response.json();
        const latency = Date.now() - start;
        
        metrics.totalOps++;
        metrics.totalLatency += latency;
        metrics.endTime = Date.now();
        
        if (response.ok) {
          metrics.successOps++;
          return { success: true, data: result, latency };
        } else {
          metrics.failedOps++;
          return { success: false, error: result.error, latency };
        }
      } catch (error) {
        metrics.totalOps++;
        metrics.failedOps++;
        const latency = Date.now() - start;
        metrics.totalLatency += latency;
        metrics.endTime = Date.now();
        return { success: false, error: error.message, latency };
      }
    }

    async function fetchStats() {
      try {
        const response = await fetch(`${API_URL}/api/stats`);
        const data = await response.json();
        
        document.getElementById('cacheSize').textContent = data.size;
        document.getElementById('hitRate').textContent = parseFloat(data.hitRate) || 0;
        document.getElementById('totalHits').textContent = data.hits;
        document.getElementById('totalMisses').textContent = data.misses;
        
        log('info', `ğŸ“Š Stats: ${data.size} cached, ${data.hitRate} hit rate`);
      } catch (error) {
        log('error', `âŒ Stats error: ${error.message}`);
      }
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // TESTS
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    function setIntensity(level) {
      currentIntensity = level;
      
      document.querySelectorAll('.intensity-btn').forEach(btn => btn.classList.remove('active', 'ring-4', 'ring-offset-2'));
      event.target.classList.add('active', 'ring-4', 'ring-offset-2');
      
      const config = intensityConfig[level];
      document.getElementById('intensityInfo').innerHTML = config.description.replace(/\n/g, '<br>');
      
      log('info', `ğŸ¯ Intensity: ${level.toUpperCase()} (${config.operations} ops, max ${config.concurrent} concurrent)`);
    }

    async function runCRUDTest() {
      if (!authToken) return log('error', 'âŒ Please login first');
      if (isRunning) return log('warning', 'âš ï¸ Test already running');
      
      isRunning = true;
      const config = intensityConfig[currentIntensity];
      const maxConcurrent = config.concurrent;
      
      log('info', `ğŸš€ CRUD Test: ${config.operations} ops, max ${maxConcurrent} concurrent`);
      resetMetrics();
      
      const testBtn = document.getElementById('testBtn');
      testBtn.disabled = true;
      testBtn.classList.add('animate-pulse-slow');
      
      const pool = new ConcurrencyPool(maxConcurrent);
      const createdIds = [];
      
      // CREATE
      log('info', `ğŸ“ Creating ${config.operations} records...`);
      const createPromises = [];
      
      for (let i = 0; i < config.operations; i++) {
        createPromises.push(
          pool.run(async () => {
            const result = await makeRequest('POST', '/api/collections/test_posts/records', {
              title: `Test Post ${i + 1}`,
              content: `Content ${i + 1}`,
              status: 'published',
              views: Math.floor(Math.random() * 1000)
            });
            
            if (result.success) {
              createdIds.push(result.data.id);
            }
            
            updateProgress(createdIds.length, config.operations);
            updateMetrics();
            
            return result;
          })
        );
      }
      
      await Promise.all(createPromises);
      log('success', `âœ… Created ${createdIds.length}/${config.operations} records`);
      
      // READ
      log('info', `ğŸ“– Reading ${createdIds.length} records...`);
      const readPromises = [];
      let readCount = 0;
      
      for (const id of createdIds) {
        readPromises.push(
          pool.run(async () => {
            const result = await makeRequest('GET', `/api/collections/test_posts/records/${id}`);
            readCount++;
            updateProgress(readCount, createdIds.length);
            updateMetrics();
            return result;
          })
        );
      }
      
      await Promise.all(readPromises);
      log('success', `âœ… Read ${readCount} records`);
      
      // UPDATE
      log('info', `âœï¸ Updating ${createdIds.length} records...`);
      const updatePromises = [];
      let updateCount = 0;
      
      for (const id of createdIds) {
        updatePromises.push(
          pool.run(async () => {
            const result = await makeRequest('PATCH', `/api/collections/test_posts/records/${id}`, {
              views: Math.floor(Math.random() * 5000)
            });
            updateCount++;
            updateProgress(updateCount, createdIds.length);
            updateMetrics();
            return result;
          })
        );
      }
      
      await Promise.all(updatePromises);
      log('success', `âœ… Updated ${updateCount} records`);
      
      // DELETE
      log('info', `ğŸ—‘ï¸ Deleting ${createdIds.length} records...`);
      const deletePromises = [];
      let deleteCount = 0;
      
      for (const id of createdIds) {
        deletePromises.push(
          pool.run(async () => {
            const result = await makeRequest('DELETE', `/api/collections/test_posts/records/${id}`);
            deleteCount++;
            updateProgress(deleteCount, createdIds.length);
            updateMetrics();
            return result;
          })
        );
      }
      
      await Promise.all(deletePromises);
      log('success', `âœ… Deleted ${deleteCount} records`);
      
      hideProgress();
      
      const duration = ((metrics.endTime - metrics.startTime) / 1000).toFixed(2);
      log('success', `ğŸ‰ CRUD test completed in ${duration}s`);
      log('info', `ğŸ“Š Success: ${metrics.successOps}/${metrics.totalOps} (${((metrics.successOps/metrics.totalOps)*100).toFixed(1)}%)`);
      
      testBtn.disabled = false;
      testBtn.classList.remove('animate-pulse-slow');
      isRunning = false;
      fetchStats();
    }

    async function runBatchTest() {
      if (!authToken) return log('error', 'âŒ Please login first');
      if (isRunning) return log('warning', 'âš ï¸ Test already running');
      
      isRunning = true;
      const config = intensityConfig[currentIntensity];
      
      log('info', `ğŸš€ Batch Test: ${config.operations} ops`);
      resetMetrics();
      
      const batchSize = 10;
      const batches = Math.ceil(config.operations / batchSize);
      
      for (let b = 0; b < batches; b++) {
        const requests = [];
        const currentBatchSize = Math.min(batchSize, config.operations - (b * batchSize));
        
        for (let i = 0; i < currentBatchSize; i++) {
          requests.push({
            method: 'create',
            collection: 'test_batch',
            data: { title: `Batch ${b * batchSize + i + 1}` }
          });
        }
        
        const result = await makeRequest('POST', '/api/batch', { requests });
        updateProgress(b + 1, batches);
        updateMetrics();
        
        if (result.success) {
          log('success', `âœ… Batch ${b + 1}/${batches} (${currentBatchSize} ops, ${result.latency}ms)`);
        }
      }
      
      hideProgress();
      log('success', `ğŸ‰ Batch test completed`);
      isRunning = false;
      fetchStats();
    }

    async function runConcurrentTest() {
      if (!authToken) return log('error', 'âŒ Please login first');
      if (isRunning) return log('warning', 'âš ï¸ Test already running');
      
      isRunning = true;
      const config = intensityConfig[currentIntensity];
      const maxConcurrent = config.concurrent;
      
      log('info', `ğŸš€ Concurrent Test: ${config.operations} ops, ${maxConcurrent} concurrent`);
      resetMetrics();
      
      const pool = new ConcurrencyPool(maxConcurrent);
      const promises = [];
      let completed = 0;
      
      for (let i = 0; i < config.operations; i++) {
        promises.push(
          pool.run(async () => {
            const result = await makeRequest('POST', '/api/collections/test_concurrent/records', {
              index: i,
              timestamp: new Date().toISOString()
            });
            completed++;
            updateProgress(completed, config.operations);
            updateMetrics();
            return result;
          })
        );
      }
      
      await Promise.all(promises);
      
      hideProgress();
      log('success', `ğŸ‰ Concurrent test completed`);
      isRunning = false;
      fetchStats();
    }

    async function runFullTest() {
      await runCRUDTest();
      await sleep(1000);
      await runBatchTest();
      await sleep(1000);
      await runConcurrentTest();
      log('success', 'ğŸ‰ FULL TEST SUITE COMPLETED!');
    }

    async function deleteAllData() {
      if (!confirm('âš ï¸ Delete ALL test data?')) return;
      
      log('warning', 'ğŸ—‘ï¸ Deleting test data...');
      
      const collections = ['test_posts', 'test_batch', 'test_concurrent'];
      
      for (const collection of collections) {
        try {
          const result = await makeRequest('GET', `/api/collections/${collection}/records?perPage=1000`);
          
          if (result.success && result.data.items) {
            for (const item of result.data.items) {
              await makeRequest('DELETE', `/api/collections/${collection}/records/${item.id}`);
            }
            log('success', `âœ… Deleted ${result.data.items.length} from ${collection}`);
          }
        } catch (error) {
          log('error', `âŒ Error deleting ${collection}`);
        }
      }
      
      log('success', 'ğŸ‰ All test data deleted');
      fetchStats();
    }

    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    // INIT
    // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    window.addEventListener('load', () => {
      log('info', 'ğŸš€ NanoDB Tester Ready');
      log('info', 'ğŸ’¡ Login to start testing');
      
      setInterval(() => {
        if (authToken && !isRunning) fetchStats();
      }, 5000);
    });
  </script>
</body>
</html>
